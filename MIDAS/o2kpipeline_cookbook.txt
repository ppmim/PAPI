# Cookbook for simple use of the OMEGA2000 pipeline
#
# Rene Fassbender (MPE)
#
# 02.11.2006


>> shell commands
>  MIDAS commands 



I. REALTIME REDUCTION & RESULTS DISPLAY 
======================================= 

# start observations with 'o2k/dither'

# create a new directory for reduced (create new dir for every observation series)
>>mkdir H_14CA

# change to this directory in the PIPE MIDAS session
>ch/dir H_14CA

# Start pipeline in online mode after first images have been written to disk (crashes otherwise)
# Online Mode with default settings: 5 skyframes, sky clipping mode, every 7th frame written to disk
# currently implemented for Z,J,H,Ks filters
>o2k/online 


# in a terminal change to reduction directory and start automatic upload of intermediate results
# start after a few images have been fully reduced, i.e. a few minutes after the pipeline was started
# argument just speciefies the name of the final image (can be arbitrrary): finalcut_H_field14.fits
>>cd H_14CA
>>o2ksum H_field14

# intermediate results will be automatically displayed in a ds9 window as soon as they are available (every 7 images)
# that's it,...just relax and wait for the results to come in


...........................

# NOTE on calibration files:
# default calibration files were prepared in Jan2006 for Z,J,H,Ks filters

# if other filter is used, a user specified flatfield has to be given to pipeline
# instead of o2k/online the command is:
>o2k/pipe icat=automatic frames=2 mode=2,5.0 sum=7,0,0 flatfield=your_flat.fits


# online help
>o2k/pipe help




II. AUTOMATED SCIENCE REDUCTION 
================================

# go to directory where reduced data is to be written to
>ch/dir H_14CA

# create image catalog with files (of same pointing) to be fully reduced
>create/icat H_allcat ../061101/*.fits

# do first reduction + object mask creation + second reduction with object masking with default settings
>o2k/full H_allcat

# info on the final summation results will be saved in 
P2_weightsum_info_*.txt

# the final weighted coadded image will be:
weightsum_H_allcat.fits

# the unweighted coaded image is:
sum_H_allcat.fits


# display results
loadcuts 0,3 weightsum_H_allcat.fits



--------------------------------------
Quality Checks and Revisions:

# check the quality of the object mask
loadcuts -10,-5 mask_smooth_sum_P1*.fits

# to mask more object, lower the sigma value, to mask less sensitive increase sigma (default: sigma_mask=1.5)
# optimized object mask
#o2k/makemask H_allcat frames=2,simga_mask
>o2k/makemask H_allcat frames=2,1.0

# once mask is ok, redo the second reduction pass with masking
>o2k/second H_allcat


.........................................
# this works again automatically for Z,J,H,Ks filters
# for other filters, the flatfield has to be user provided

# online help
>o2k/science help


# the full science pipeline is available here:
ftp://ftp.xray.mpe.mpg.de/people/rfassben/O2K_SCIENCE_V5_31oct06





III. USEFUL UTILITIES
=====================

# load image in ds9 with speciefied cuts in units of sigma of the background
# loadcut min_sigma,max_sigma image.fits
# set cuts to median-1sigma, median+2sigma
>>loadcuts -1,2 image.fits

# use default cuts values from fits header
>>loadcuts image.fits
 

 
# write approximate World Coordinate Sytem to an image
# central pixel is assigned the pointing coordinates
>>o2kwcs input.fits

 
