SOFTWARE INTEGRATION : NOTES FROM THE VISIT TO HEIDELBERG (21-Nov to 25-Nov 2011)
=================================================================================
Attending: JF(Josef Fried), CS (Clemens Storz), AG (Antonio Garc√≠a) and JM
(Jose Miguel)

- AG and JM connected their laptops to the PANIC lab network (192.168.2.180-1-2-3)
and then worked connected as remote terminals to the irws2 PANIC workstation.
- All the software (OT, QL, PL) was installed and configured in the
irws2.mpia.de workstation during the first day.
- Then, a lot of tests were run; some problems where detected, some of
them were solved and other annotated to be solved later. 

Bellow are listed some of the notes as a summary of the tests:

Observation Tool (OT)
~~~~~~~~~~~~~~~~~~~~~
- read-save-sync cycle was optimized in the OT
- In principle, the supported readout modes should be the double correlated (lir, 
rrr-mpia), but the final decision will be taken during the commissioning. 
- Because GEIRS is not still implementing the dome flat lamps control
(on/off), was decided that at the beginning, the OT will command and control
them via the shell commands supported by CA (E.Guindos)
- The filter wheel software is not completed in GEIRS, so we ran the tests
only with the filter wheel in simulation mode.
- Object name resolver is right, but JF suggested that a chart of the field would 
be appreciated in the OT.
- Cold-stop filter wheel position could be moved by OT with the filter command, 
but in principle it will not be done by the OT; it will be done by GEIRS. That 
filter wheel has a not very long life-time, so it is better we do not move too 
much.
- In principle, initial resets in Dark/Flat series are not required, however 
because they are currently implemented in OT, we can be keep them until the 
commissioning to decide if they were required.
- JF suggests a new way to specify the total exposition time ( 3+2 boxes, Total 
Exp.Time, single exp. time, Integration Time, and to be calculated #coadds and 
#dither positions)
- JF suggests to add the option of reading a .txt file including for example 
: target, total exp.time, readout mode and dither pattern, in order to create 
automatically the OBs required in the OT.
- JF suggests that must be possible to stop and re-start the execution of any OB 
at a given position.
- OT should show the Total Exposure time of OB and the total time required 
for the execution (lap time taking into account the overheads)
- Some sounds in OT are desirable in order to follow its work & status
- Concerning the Nodding procedures (S-T-T-S-T-S- etc) JF has some doubts about
how to proceed, and suggest ask to CA staff (Ana Guijarro, Ulli, etc) to find
out about the best patterns.
- Skyflats with fixed exposition time are need to be implemented in the OT;
currently only skyflat with fixed exposition level are implemented.

Quick-Look (QL)
~~~~~~~~~~~~~~~
- Firstly, a synchronization problem while QL read new files from disk was 
detected. The problem was due to an early access to just new created FITS file 
with a incomplete header. It was resolved setting up the 
"~/tmp/fitsfiles.corrected" as the source for the QL. However, JM will look for
a solution for the sync problem when a directory is specified.
- Must be possible to check the photometry of a specific star in selected in 
the display. In principle, IRAF task imexam or qphot can be good options, taking 
into account the ZP computed.
- In principle, the QL will not support dark series, so the dark model routine 
will not be launched with that kind of series by the QL. 
- A short delay (aprox. 1-2 secs) exists between GEIRS save a file and QL detect 
it, but QL was configured to check the source path every 1.5sec, so it could be 
improved.
- Although irws2 is configured with the MPIA proxy setup, both OT and DS9 
needed to setup manually the proxy for the internet connection from MPIA LAN 
(ftp-proxy.mpia.de:3128). CDSClient read successfully the proxy setup from 
the system. 

Pipeline (PL)
~~~~~~~~~~~~~
- Current implementations for focusing evaluation (iraf.starfocus & 
eval_focus_serie) look like good for JF. 
- Should be possible to modify some of the pipeline tasks parameters (iraf 
config, SExtractor, etc) and run again the data reduction with the new setup
- In principle, all the readout modes (rrr-mpia, lir, etc) will be processed 
in the same way, no special differences for PAPI.
- Should be available some routines for health-check of the instrument, so they 
can be executed periodically and the results stored into a DB for historical 
review. JF will provided his MIDAS routines than can be used (and translated 
to Python) for this purpose. In addition, CA has a system for that store that 
values, so we should integrate our results with their system.
- A list with the main pipeline routines and a brief explanation of what they do
is required. JM will prepare it.
- Review the FITS headers in order the ask CS what new keywords are needed.
- The science sequences files must have the same readout and saving features 
(readmode, EXPT, NCOADD,etc), and the mask dark should match with them as well.   
- Should be supported the data processing of data when they are saved as cubes
or individual; currently only integrated mode is supported. It means changes 
in all the routines.
- Because must be possible to stop and re-start the execution of any OB at a 
given position, the PL should have some tool to try to fix the OT-headers 
keys in order to set a new sequence numbering to allow the automatic processing.
- Data processing in parallel was successfully tested; a improvement of a 
factor of 3 was achieved (tests were done with O2K and HAWK-I datasets).
- In principle, no problems running GEIRS-OT-QL-PL in the same computer 
(2x Quad-Core AMD Opteron CPU with 32GB RAM); however, we got some error running 
read in GEIRS while all process were running ( GEIRS, OT, PL with HAWK-I-3 S3, QL); 
CS thinkg it could be related with the CPU load. We repeat the test after reboot
the workstation and got again the same error in the 'read' command (well, OT get
the error during the 'sync' command, but all and CS point out that the problem was
in the readout). See notes bellow about 'Main GEIRS problems'.
- Photometric estimation routine was shown to JF with a data set from ALHAMBRA; 
he think the procedure is OK and enough, but the difference value between 
ZP_intercept and ZP_median is too big, they should be the same, and the slope 
must be 1, and not 0.9. He does not like too much to see the fit plot with the
fitting values and the negative values in the InstMag. The only thing the
astronomer what to see is the ZP and/or the magnitude of each star.
JF confirms to JM that the STD is the precision of the photometry.  
JF suggest that review the SExtractor parameters (aperture values) because the
error might be flux computation (some flux is lost)
In addition, JF suggest that run the photometry routine in the individual images
and check that the ZP is consistent (the same value for each image).  


Main GEIRS problems
~~~~~~~~~~~~~~~~~~~
- A read-error was detected in GEIRS while a long sequence was running on the   
  OT, the QL running and the off-line pipeline running with a large HAWK-I
  dataset. CS suggested a system reboot, but after that, the error persists and
  arose again at the next local data-times:
  - 2011-11-25 13:37:21.5
  - 2011-11-25 16:01:05
  - 2011-11-25 16:19:00
     
- In 'lir' mode, when the OT set 1sec for IT, GEIRS shows in the IT
  field the 5615secs. It does not seem to happen when manual use of GEIRS
  without OT.


Action Items for Clemens
~~~~~~~~~~~~~~~~~~~~~~~~
- dome flat lamp on/off 
- Fix bug in 'lir' mode that set IT to 5615secs
- subwindow commands and functionality
- filter wheel software not completelly finished
- some FITS keywords would be needed (SAVEMODE, DETECTOR parameters, ...)
- better way to know if GEIRS is running in order to avoid a bad initialization
- median command should return the values instead of read them from a text file
- solve sporadic 'read' fail (see main GEIRS problems)

Conclusions
~~~~~~~~~~~
JM: The tests showed that althout there are still some functionalities to implement or 
improve, there are not serious problems and we are in the right way to reach the
aims of the software package.